!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FlexGridify=t():e.FlexGridify=t()}(self,(()=>(()=>{"use strict";var e={d:(t,r)=>{for(var i in r)e.o(r,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:r[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>i});function r(e,t){for(const r of t)e.style.removeProperty(r)}const i=class{constructor(e=null,t={}){e&&t&&this.initialize(e,t)}getDefaultOptions(){return{enableLogQuery:!1,enableResponsiveLayout:!0,enableSmoothLoading:!1,enableDynamicHeight:!0,enableDragAndDrop:!1,rememberDragAndDropPosition:!0,dragAndDropAnimation:{opacity:.5,transform:"translate(0.25em, -0.25em)"},columnBreakpoints:{1500:6,1200:5,992:4,768:3,576:2,0:1},onDragAndDropChange:null,onBreakpointChange:null,gap:1,marginTop:0,marginBottom:0,defaultColumnCount:1,sizeUnit:"em",breakpointSelector:"window",dragAndDropSelector:"default"}}initialize(e,t){this.defaultOptions=this.getDefaultOptions(),this.options={...this.defaultOptions,...t},e&&(this.element=document.querySelector(e),this.#e(),this.#t(),this.#r(),this.#i(),this.enableSmoothLoading&&setTimeout((()=>{this.element.classList.remove(this.#s)}),12))}getBreakpointQuery(e="columns"){const t="columns"===e?this.defaultColumnCount:"No query, `responsive` is set to `false`";if(!this.enableResponsiveLayout)return t;return this.#n(((t,[r,i,s],n,a)=>{if("object"==typeof t){const n=parseFloat(window.getComputedStyle(t).width);if(n>r&&!(n>i))return"columns"===e?s:r}else if(n.matches&&!a.matches)return"columns"===e?s:r}))||t}applyMarginTop(){this.#a(this.marginTop,"number"),Array.from(this.element.children).forEach((e=>{e.style.marginTop=`${this.marginTop}${this.sizeUnit}`}))}applyMarginBottom(){this.#a(this.marginBottom,"number"),Array.from(this.element.children).forEach((e=>{e.style.marginBottom=`${this.marginBottom}${this.sizeUnit}`}))}applyMargins(){this.#a(this.marginTop,"number"),this.#a(this.marginBottom,"number"),Array.from(this.element.children).forEach((e=>{e.style.marginTop=`${this.marginTop}${this.sizeUnit}`,e.style.marginBottom=`${this.marginBottom}${this.sizeUnit}`}))}applyHeightChange(e){if(e||(e=this.getBreakpointQuery("columns")),e<2)return void this.element.style.removeProperty("height");const t=Array.from(this.element.children),r=new Array(e).fill(0),i=t.map((e=>window.getComputedStyle(e))),s=parseFloat(i[0].getPropertyValue("font-size")),n=this.#o(s);for(let e=0;e<t.length;e++){if(t[e].classList.contains(this.#l))continue;const a=i[e],o=parseFloat(a.getPropertyValue("order"),10),l=parseFloat(a.getPropertyValue("height")),h="em"===this.sizeUnit?this.gap*s:this.gap;r[o-1]+=Math.ceil(l)+n+h}this.element.style.height=`${Math.max(...r)}px`}applyColumnClass(e){e||(e=this.getBreakpointQuery("columns"));const t=`flexGridify-cols-${e}`;this.element.classList.contains(t)||(this.element.className=this.element.className.replace(/flexGridify-cols-\d+/,""),this.element.classList.add(t))}applyColumnBreaks(e){if(e||(e=this.getBreakpointQuery("columns")),this.element.querySelectorAll(`.${this.#l}`).length!==e-1){this.#h();for(let t=1;t<e;t++){const e=document.createElement("div");e.classList.add(this.#l,`${this.#l}-${t}`),this.element.appendChild(e)}}}applyGap(e){this.#a(this.gap,"number"),e||(e=this.getBreakpointQuery("columns"));const t=this.sizeUnit,r=this.gap,i=r/2,s=i*(e+(e-1)-1)/e;document.documentElement.style.setProperty("--flexGridify-row-gap",`${r}${t}`),document.documentElement.style.setProperty("--flexGridify-column-gap",`${i}${t}`),document.documentElement.style.setProperty("--flexGridify-column-width-calc",`calc((100% / ${e}) - ${s}${t})`)}reset(){this.#p();const e=this.getBreakpointQuery("columns");this.applyMargins(),this.applyGap(e),this.applyColumnClass(e),this.applyColumnBreaks(e),this.applyHeightChange(e)}disconnectDynamicObservers(){for(const[e,t]of this.#m)t.unobserve(e),t.disconnect();this.#m.clear()}connectDynamicObservers(){Array.from(this.element.children).forEach((e=>{this.enableDynamicHeight&&this.#d(e)}))}resetBreakpoints(){this.cleanupBreakpointListeners(),this.#r()}cleanupBreakpointListeners(){0!==this.#c.size&&(this.#c.forEach(((e,t)=>{t.removeEventListener("change",e)})),this.#c.clear()),this.#u&&(this.#u(),this.#u=null)}cleanupDndListeners(){this.#g.forEach(((e,t)=>{this.element.removeEventListener(t,e)})),this.#g.clear(),Array.from(this.element.children).forEach((e=>{"default"===this.dragAndDropSelector?e.removeAttribute("draggable"):e.querySelector(this.dragAndDropSelector).removeAttribute("draggable")}))}reinitDragAndDrop(){if(!this.enableDragAndDrop)return;const e=this.getBreakpointQuery("columns"),t=document.createDocumentFragment(),r=Array.from(this.element.children),i=Array.from({length:r.length},((e,t)=>t));(this.rememberDragAndDropPosition?JSON.parse(localStorage.getItem("gridOrder"))??i:i).forEach((e=>{const i=r.find((t=>parseInt(t.getAttribute("data-draggable-id"))===e));i&&("default"===this.dragAndDropSelector?i.setAttribute("draggable","true"):i.querySelector(this.dragAndDropSelector).setAttribute("draggable","true"),i.setAttribute("data-draggable-id",e),t.appendChild(i))})),this.element.innerHTML="",this.element.appendChild(t),this.applyColumnBreaks(e),this.#i()}#h(){this.element.querySelectorAll(".flexGridify-break").forEach((e=>e.remove()))}#a(e,t){if(typeof e!==t)throw TypeError(`Incorrect type for '${e}' property. It is '${t}'.`)}#o(e){let t=0;return this.marginBottom&&(t+="em"===this.sizeUnit?this.marginBottom*e:this.marginBottom),this.marginTop&&(t+="em"===this.sizeUnit?this.marginTop*e:this.marginTop),t}#f(e=!1,t=null){e&&this.onBreakpointChange?(this.enableLogQuery&&t&&console.log("%cThreshold:","color: #0d6efd;",t),this.onBreakpointChange()):this.enableLogQuery&&t&&console.log("%cThreshold:","color: #0d6efd;",t);const r=this.getBreakpointQuery("columns");this.applyMargins(),this.applyGap(r),this.applyColumnClass(r),this.applyColumnBreaks(r),this.applyHeightChange(r)}#t(){this.element.classList.add(this.#y);const e=document.createDocumentFragment(),t=Array.from(this.element.children),r=Array.from({length:t.length},((e,t)=>t));(this.rememberDragAndDropPosition?JSON.parse(localStorage.getItem("gridOrder"))??r:r).forEach((r=>{const i=t[r];i&&(i.classList.add(this.#b),"default"===this.dragAndDropSelector?i.setAttribute("draggable",this.enableDragAndDrop?"true":"false"):i.querySelector(this.dragAndDropSelector).setAttribute("draggable",this.enableDragAndDrop?"true":"false"),i.setAttribute("data-draggable-id",r),this.enableDynamicHeight&&this.#d(i),e.appendChild(i))})),this.element.innerHTML="",this.element.appendChild(e)}#r(){const e=this.#f.bind(this);this.#n(((t,[r,i,s],n,a)=>{if("object"==typeof t){const s=parseFloat(window.getComputedStyle(t).width);if(s>r&&!(s>i)){const r=function(e,t,r=null){if(!e||!Array.isArray(t)||0===t.length)return void console.warn("Invalid element or breakpoints");const i=new Map(t.map((e=>[e,!1]))),s=new ResizeObserver((s=>{for(let n of s)n.target===e&&requestAnimationFrame((()=>{var e;e=n.target.clientWidth,t.forEach(((s,n)=>{const a=e>s;if(a!==i.get(s)){i.set(s,a);const o=e>t[n+1];r&&!0!==o&&r(!0,s)}}))}))}));return s.observe(e),()=>{s.unobserve(e),s.disconnect()}}(t,Object.keys(this.columnBreakpoints),e);this.#u=r}}else{const t=()=>{e(!0,r)};n.addEventListener("change",t),n.matches&&!a.matches&&t(),this.#c.set(n,t)}}))}#d(e){let t=new Map;const r=new ResizeObserver((e=>{requestAnimationFrame((()=>{for(let r of e){const e=r.target,i=r.contentRect.height;if(t.has(e)){if(t.get(e)!==i){const r=this.getBreakpointQuery("columns");r>1&&this.applyHeightChange(r),t.set(e,i)}}else t.set(e,i)}}))}));r.observe(e),this.#m.set(e,r)}#i(){if(!this.enableDragAndDrop)return;let e,t,i;[["dragstart",r=>{const i=r.target.closest(`.${this.#b}`)??r.target;if(r.dataTransfer.setDragImage(i,r.offsetX,r.offsetY),"default"!==this.dragAndDropSelector){const t=i.querySelector(this.dragAndDropSelector);e!==t&&e!==this.element&&(r.preventDefault(),r.stopPropagation(),r.stopImmediatePropagation())}t=r.target.closest(`.${this.#b}`)}],["dragenter",e=>{var t,r;i=e.target.closest(`.${this.#b}`),i&&(t=i,r=this.dragAndDropAnimation,Object.entries(r).forEach((([e,r])=>{t.style.setProperty(e,r)})))}],["dragleave",e=>{const s=e.target.closest(`.${this.#b}`);null!==s&&s!==i&&s!==t&&r(s,Object.keys(this.dragAndDropAnimation))}],["dragover",e=>{e.preventDefault()}],["drop",e=>{const i=e.target.closest(`.${this.#b}`);null!==i&&(r(i,Object.keys(this.dragAndDropAnimation)),function(e,t){const r=e.nextElementSibling;r===t?t.parentNode.insertBefore(t,e):e.previousElementSibling===t?t.parentNode.insertBefore(e,t):(t.parentNode.insertBefore(e,t),e.parentNode.insertBefore(t,r))}(t,i),this.applyHeightChange(),this.#D())}],["dragend",e=>{r(t,Object.keys(this.dragAndDropAnimation))}],"default"!==this.dragAndDropSelector?["mousedown",t=>{e=t.target}]:null].filter(Boolean).forEach((([e,t])=>{this.element.addEventListener(e,t),this.#g.set(e,t)}))}#D(){if(!this.rememberDragAndDropPosition)return;const e=Array.from(this.element.querySelectorAll(`.${this.#b}`)).map((e=>parseInt(e.getAttribute("data-draggable-id"))));localStorage.setItem("gridOrder",JSON.stringify(e)),this.onDragAndDropChange&&this.onDragAndDropChange(e)}#n(e){const t=Object.entries(this.columnBreakpoints).sort(((e,t)=>e-t)),r="window"!==this.breakpointSelector?document.querySelector(this.breakpointSelector):this.breakpointSelector;for(var i=0;t.length>i;i++){const s=t[i],n=t[i+1]??[],a=s[0],o=n[0],l=window.matchMedia(`(min-width: ${a}px)`),h=!!o&&window.matchMedia(`(min-width: ${o}px)`),p=e(r,[a,o,s[1]],l,h);if(p)return p}return null}#p(){if("px"!==this.sizeUnit&&"em"!==this.sizeUnit)throw TypeError("Incorrect input. 'sizeUnit' has to be either 'em' or 'px'");if(this.defaultColumnCount>8)throw TypeError(`${this.defaultColumnCount} columns is restricted. Maximum amount of columns 'FlexGridify' can have by default is 8, if more is needed consider to change it manually`)}#g;#c;#m;#u;#b;#l;#s;#y;#e(){const{gap:e,sizeUnit:t,enableSmoothLoading:r,enableDragAndDrop:i,dragAndDropAnimation:s,rememberDragAndDropPosition:n,marginTop:a,marginBottom:o,enableLogQuery:l,enableDynamicHeight:h,breakpointSelector:p,dragAndDropSelector:m,defaultColumnCount:d,enableResponsiveLayout:c,columnBreakpoints:u,onBreakpointChange:g,onDragAndDropChange:f}=this.options;this.sizeUnit=t,this.enableSmoothLoading=r,this.enableDragAndDrop=i,this.rememberDragAndDropPosition=n,this.dragAndDropAnimation=s,this.gap=e,this.marginTop=a,this.marginBottom=o,this.enableLogQuery=l,this.enableDynamicHeight=h,this.breakpointSelector=p,this.dragAndDropSelector=m,this.defaultColumnCount=d,this.enableResponsiveLayout=c,this.onBreakpointChange=g,this.onDragAndDropChange=f,this.columnBreakpoints=u,this.#g=new Map,this.#c=new Map,this.#m=new Map,this.#u=null,this.#b="flexGridify-item",this.#l="flexGridify-break",this.#s="flexGridify-init",this.#y="flexGridify"}};return t.default})()));